<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Big Number</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#111111"/>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      background: #000;
      color: #fff;
      -webkit-user-select: none;
      user-select: none;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    }
    .wrap {
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
    }
    #display {
      width: 100%;
      text-align: center;
      line-height: 1;
      font-weight: 700;
      /* Start large; JS will fine-tune */
      font-size: 25vmin;
      word-break: break-word;
      padding: 0 2vw;
    }
    #editBtn {
      position: fixed;
      right: calc(12px + env(safe-area-inset-right));
      bottom: calc(12px + env(safe-area-inset-bottom));
      padding: 12px 16px;
      border-radius: 999px;
      border: 0;
      background: #1f6feb;
      color: #fff;
      font-weight: 600;
      font-size: 16px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.35);
    }
    #editBtn:active { transform: translateY(1px); }
    /* Hidden input sheet */
    #sheet {
      position: fixed;
      left: 0; right: 0; bottom: 0;
      background: #111;
      border-top: 1px solid #333;
      padding: 16px;
      display: none;
      gap: 8px;
      box-shadow: 0 -12px 30px rgba(0,0,0,0.4);
    }
    #numInput {
      flex: 1;
      font-size: 22px;
      padding: 12px 14px;
      border-radius: 10px;
      border: 1px solid #333;
      background: #000;
      color: #fff;
      outline: none;
    }
    .btn {
      padding: 12px 16px;
      border-radius: 10px;
      border: 1px solid #333;
      background: #222;
      color: #fff;
      font-weight: 600;
    }
    .btn.primary { background: #1f6feb; border-color: #1f6feb; }
  </style>
</head>
<body>
  <div class="wrap">
    <div id="display" aria-live="polite">0</div>
    <button id="editBtn" aria-label="Edit number">Edit</button>
  </div>

  <!-- Bottom sheet for editing -->
  <div id="sheet" role="dialog" aria-modal="true" aria-label="Edit number">
    <input id="numInput" inputmode="decimal" pattern="[0-9.,\- ]*" placeholder="Enter a number" />
    <button id="saveBtn" class="btn primary">Save</button>
    <button id="cancelBtn" class="btn">Cancel</button>
  </div>

  <script>
    const KEY = 'bigNumber:value';
    const display = document.getElementById('display');
    const editBtn = document.getElementById('editBtn');
    const sheet = document.getElementById('sheet');
    const input = document.getElementById('numInput');
    const saveBtn = document.getElementById('saveBtn');
    const cancelBtn = document.getElementById('cancelBtn');

    function load() {
      const v = localStorage.getItem(KEY);
      display.textContent = v !== null ? v : '0';
      requestAnimationFrame(fitText);
    }

    function openSheet() {
      input.value = display.textContent;
      sheet.style.display = 'flex';
      input.focus();
      input.select();
    }

    function closeSheet() {
      sheet.style.display = 'none';
    }

    function save() {
      const v = input.value.trim();
      if (v.length === 0) return;
      localStorage.setItem(KEY, v);
      display.textContent = v;
      closeSheet();
      fitText();
    }

    // Tap anywhere to edit (besides the buttons)
    display.addEventListener('click', openSheet);
    editBtn.addEventListener('click', openSheet);
    saveBtn.addEventListener('click', save);
    cancelBtn.addEventListener('click', closeSheet);
    input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') save();
      if (e.key === 'Escape') closeSheet();
    });

    // Fit text to viewport: decrease font until it fits.
    function fitText() {
      const maxFont = Math.min(window.innerWidth, window.innerHeight) * 0.8; // px upper bound
      let size = Math.min(parseFloat(getComputedStyle(display).fontSize), maxFont);
      display.style.fontSize = size + 'px';
      const wrap = display.parentElement;
      const w = wrap.clientWidth - 16; // padding allowance
      const h = wrap.clientHeight - 16;

      // Guard against infinite loops
      let guard = 120;
      while (guard-- > 0 && (display.scrollWidth > w || display.scrollHeight > h)) {
        size *= 0.95;
        display.style.fontSize = size + 'px';
      }
    }

    window.addEventListener('resize', fitText);
    window.addEventListener('orientationchange', fitText);
    document.addEventListener('visibilitychange', () => {
      if (!document.hidden) fitText();
    });

    // PWA: register service worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js').catch(() => {});
      });
    }

    load();
  </script>
</body>
</html>
